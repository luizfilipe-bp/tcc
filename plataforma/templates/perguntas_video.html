{% extends 'base.html' %}

{% block titulo %}Perguntas do vídeo{% endblock %}

{% block conteudo %}
<div class="container my-4">
    <h1 class="mb-4">Perguntas do Vídeo: {{ playlist_video.video.titulo }}</h1>

    <section class="mb-5">
        <h2 class="mb-3">Perguntas de Alternativas</h2>
        {% if perguntas_alternativas %}
            <div class="row">
                {% for pergunta in perguntas_alternativas %}
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <strong>{{ pergunta.pergunta }}</strong>
                                <a href="{% url 'excluir_pergunta' id=playlist_video.playlist.id id_video=playlist_video.video.id id_pergunta=pergunta.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir esta pergunta?');">X</a>
                            </div>
                            <div class="card-body">
                                <p><small class="text-muted">Autor: {{ pergunta.autor }}</small></p>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">1) {{ pergunta.alternativa1 }}</li>
                                    <li class="list-group-item">2) {{ pergunta.alternativa2 }}</li>
                                    <li class="list-group-item">3) {{ pergunta.alternativa3 }}</li>
                                    <li class="list-group-item">4) {{ pergunta.alternativa4 }}</li>
                                </ul>
                                <p class="mt-2">
                                    <em>Alternativa correta:</em> {{ pergunta.alternativa_correta }}
                                </p>
                                <p>
                                    <em>Avaliação:</em> +{{ pergunta.avaliacao_positiva }} / -{{ pergunta.avaliacao_negativa }}
                                </p>
                            </div>
                            <div class="card-footer text-end">
                                <small class="text-muted">Criado em: {{ pergunta.criado_em|date:"d/m/Y H:i" }}</small>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="alert alert-info">Nenhuma pergunta de alternativas encontrada para este vídeo.</p>
        {% endif %}
    </section>

    <section class="mb-5">
        <h2 class="mb-3">Perguntas de Verdadeiro ou Falso</h2>
        {% if perguntas_verdadeiro_falso %}
            <div class="row">
                {% for pergunta in perguntas_verdadeiro_falso %}
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <strong>{{ pergunta.pergunta }}</strong>
                                <a href="{% url 'excluir_pergunta' id=playlist_video.playlist.id id_video=playlist_video.video.id id_pergunta=pergunta.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir esta pergunta?');">X</a>
                            </div>
                            <div class="card-body">
                                <p><small class="text-muted">Autor: {{ pergunta.autor }}</small></p>
                                <p>
                                    <em>Resposta:</em> {{ pergunta.resposta|yesno:"Verdadeiro,Falso" }}
                                </p>
                                <p>
                                    <em>Avaliação:</em> +{{ pergunta.avaliacao_positiva }} / -{{ pergunta.avaliacao_negativa }}
                                </p>
                            </div>
                            <div class="card-footer text-end">
                                <small class="text-muted">Criado em: {{ pergunta.criado_em|date:"d/m/Y H:i" }}</small>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="alert alert-info">Nenhuma pergunta de verdadeiro ou falso encontrada para este vídeo.</p>
        {% endif %}
    </section>

    <section>
        <h2 class="mb-3">Adicionar Nova Pergunta</h2>
        <form action="{% url 'cadastrar_pergunta' id=playlist_video.playlist.id id_video=playlist_video.video.id %}" method="POST">
            {% csrf_token %}
            {% if formulario.errors %}
                <div class="alert alert-danger">
                    <strong>Erro:</strong> Todos os campos são obrigatórios
                </div>
            {% endif %}

            <div class="mb-3">
                <label for="{{ formulario.tipo_pergunta.id_for_label }}" class="form-label">{{ formulario.tipo_pergunta.label }}</label>
                {{ formulario.tipo_pergunta }}
            </div>
            <div class="mb-3">
                <label for="{{ formulario.pergunta.id_for_label }}" class="form-label">{{ formulario.pergunta.label }}</label>
                {{ formulario.pergunta }}
            </div>
            <div class="mb-3">
                <label for="{{ formulario.pergunta.id_for_label }}" class="form-label">{{ formulario.nivel_dificuldade.label }}</label>
                {{ formulario.nivel_dificuldade }}
            </div>

            <!-- Campos para perguntas de alternativas -->
            <div id="alternativas" style="display: none;">
                <div class="mb-3">
                    <label for="{{ formulario.alternativa1.id_for_label }}" class="form-label">{{ formulario.alternativa1.label }}</label>
                    {{ formulario.alternativa1 }}
                </div>
                <div class="mb-3">
                    <label for="{{ formulario.alternativa2.id_for_label }}" class="form-label">{{ formulario.alternativa2.label }}</label>
                    {{ formulario.alternativa2 }}
                </div>
                <div class="mb-3">
                    <label for="{{ formulario.alternativa3.id_for_label }}" class="form-label">{{ formulario.alternativa3.label }}</label>
                    {{ formulario.alternativa3 }}
                </div>
                <div class="mb-3">
                    <label for="{{ formulario.alternativa4.id_for_label }}" class="form-label">{{ formulario.alternativa4.label }}</label>
                    {{ formulario.alternativa4 }}
                </div>
                <div class="mb-3">
                    <label for="{{ formulario.alternativa_correta.id_for_label }}" class="form-label">{{ formulario.alternativa_correta.label }}</label>
                    {{ formulario.alternativa_correta }}
                </div>
            </div>

            <!-- Campo para perguntas de verdadeiro ou falso -->
            <div id="verdadeiro_falso" style="display: none;">
                <div class="mb-3">
                    <label for="{{ formulario.resposta.id_for_label }}" class="form-label">{{ formulario.resposta.label }}</label>
                    {{ formulario.resposta }}
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Adicionar Pergunta</button>
        </form>

        <div class="mt-3">
            <a href="{% url 'detalhes_playlist' playlist_video.playlist.id %}" class="btn btn-secondary">Voltar</a>
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tipoPergunta = document.querySelector('[name="tipo_pergunta"]');
        const alternativasDiv = document.getElementById('alternativas');
        const verdadeiroFalsoDiv = document.getElementById('verdadeiro_falso');

        function updateForm() {
            if (tipoPergunta.value === 'alternativas') {
                alternativasDiv.style.display = 'block';
                verdadeiroFalsoDiv.style.display = 'none';
            } else if (tipoPergunta.value === 'verdadeiro_falso') {
                alternativasDiv.style.display = 'none';
                verdadeiroFalsoDiv.style.display = 'block';
            }
        }

        tipoPergunta.addEventListener('change', updateForm);
        updateForm();
    });
</script>
{% endblock %}
